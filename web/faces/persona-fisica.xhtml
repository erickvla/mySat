<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
	  xmlns:h="http://xmlns.jcp.org/jsf/html" 
	  xmlns:f="http://xmlns.jcp.org/jsf/core" 
	  xmlns:p="http://primefaces.org/ui" 
	  xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head>

	<title>
		<h:outputText value="#{msg['app.name']}" />
	</title>
	
</h:head>

<h:body class="container">

	<h:outputStylesheet library="css" 
						name="bootstrap.css" />
	<h:outputStylesheet library="css" 
						name="styles.css" />

	<ui:debug hotkey="z"
			  rendered="#{initParam['javax.faces.PROJECT_STAGE'] ne 'Production'}" />

	<h:form id="frmMySat">
	
		<p></p>
		
		<h1>
			<h:outputText value="#{msg['app.name']}" />
		</h1>
		
		<p></p>

		<p:messages id="messages" 
					showSummary="true" 
					showDetail="false" />
					
		<p></p>
					
		<p:commandButton id="crearButton"  
						 type="button" 
						 onclick="PF('wCreateItemDialog').show();" 
						 value="#{msg['button.crear']}" />

		<p:commandButton id="eliminarButton" 
						 type="button" 
						 widgetVar="wEliminarButton"
						 onclick="PF('wEliminarConfirmDialog').show();" 
						 value="#{msg['button.eliminar']}" />
		
		<p></p>

		<p:dataTable id="itemsDataTable" 
					 value="#{personaFisicaMBean.results.resultsList}" 
					 var="pf" 
					 rowExpandMode="single" 
					 rowKey="#{pf.id}" 
					 selection="#{personaFisicaMBean.selectedItems}" 
					 editable="true">

			<p:ajax event="rowEdit"
					listener="#{personaFisicaMBean.updateItemListener}"
					update="frmMySat:messages" />

			<p:ajax event="rowEditCancel"
					listener="#{personaFisicaMBean.rowCancelListener}" />
					
			<p:ajax event="rowSelect"
					listener="#{personaFisicaMBean.rowSelectListener}" />

			<f:facet name="header">
			
				<h4>
					<h:outputText value="#{msg['title.persona.fisica']}" />
				</h4>

			</f:facet>

			<p:column width="40">
			
				<p:rowToggler rendered="#{not empty pf.estudiantes}" />
				
			</p:column>

			<p:column selectionMode="multiple" 
					  width="40" />

			<p:column headerText="#{msg['column.nombre']}" 
					  sortBy="#{pf.persona.nombre}" 
					  filterBy="#{pf.persona.nombre}" 
					  filterMatchMode="contains">

				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{pf.persona.nombre}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText id="editNombreInpTxt" 
									 value="#{pf.persona.nombre}" 
									 label="Nombre" 
							 		 maxlength="30" 
							 		 required="true" 
							 		 size="30" />
					</f:facet>
				</p:cellEditor>

			</p:column>

			<p:column headerText="#{msg['column.apellido']}" 
					  sortBy="#{pf.persona.apellido}" 
					  filterBy="#{pf.persona.apellido}" 
					  filterMatchMode="contains">

				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{pf.persona.apellido}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText id="editApellidoInpTxt"
									 value="#{pf.persona.apellido}" 
									 label="Apellido" 
							 		 maxlength="30" 
							 		 required="true" 
							 		 size="30" />
					</f:facet>
				</p:cellEditor>

			</p:column>

			<p:column headerText="#{msg['column.rfc']}" 
					  sortBy="#{pf.rfc}" 
					  filterBy="#{pf.rfc}" 
					  filterMatchMode="contains">

				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{pf.rfc}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText id="editRfcInpTxt" 
									 value="#{pf.rfc}" 
									 label="RFC" 
							 		 maxlength="15" 
							 		 required="true" 
							 		 size="15" 
							 		 valueChangeListener="#{personaFisicaMBean.onRfcValueChangeListener}" />
					</f:facet>
				</p:cellEditor>

			</p:column>

			<p:column width="55">
				<p:rowEditor />
			</p:column>

			<f:facet name="footer">
				<h:outputText value="Total Registros [#{fn:length(personaFisicaMBean.results.resultsList)}]" />
			</f:facet>

			<p:rowExpansion>

				<p:dataTable id="itemsSubDatTbl" 
							 value="#{pf.estudiantes}" 
							 var="est" 
							 rowKey="#{pf.id}" 
							 style="margin: 30px">
							 
					<f:facet name="header">
						
						<h4>
							<h:outputText value="#{msg['title.estudiante']}" />
						</h4>
						
					</f:facet>

					<p:column headerText="#{msg['column.nombre']}"
							  sortBy="#{est.persona.nombre}">

						<h:outputText value="#{est.persona.nombre}" />

					</p:column>

					<p:column headerText="#{msg['column.apellido']}"
							  sortBy="#{est.persona.apellido}">

						<h:outputText value="#{est.persona.apellido}" />

					</p:column>

					<p:column  headerText="#{msg['column.curp']}"
							  sortBy="#{est.curp}">

						<h:outputText value="#{est.curp}" />

					</p:column>

				</p:dataTable>

			</p:rowExpansion>

		</p:dataTable>

		<p:dialog id="createItemDialog" 
				  closable="true" 
				  draggable="false" 
				  maximizable="false" 
				  modal="true" 
				  position="center" 
				  resizable="false" 
				  widgetVar="wCreateItemDialog" 
				  width="550" 
				  header="#{msg['header.crear.registro']}">

			<p:panelGrid id="createItemPanelGrid" 
						 columns="2" 
						 layout="grid" 
						 columnClasses="fs.label, fs.input">

				<p:outputLabel for="nombreInputText">
					<h:outputText value="Nombre: " />
				</p:outputLabel>

				<p:inputText id="nombreInputText" 
							 label="Nombre" 
							 maxlength="30" 
							 required="true" 
							 size="30" 
							 value="#{personaFisicaMBean.properties.persona.nombre}" />

				<p:outputLabel for="apellidoInputText">
					<h:outputText value="Apellido: " />
				</p:outputLabel>

				<p:inputText id="apellidoInputText" 
							 label="Apellido" 
							 maxlength="30" 
							 required="true" 
							 size="30" 
							 value="#{personaFisicaMBean.properties.persona.apellido}" />

				<p:outputLabel for="rfcInputText">
					<h:outputText value="RFC: " />
				</p:outputLabel>

				<p:inputText id="rfcInputText" 
							 label="RFC" 
							 maxlength="15" 
							 required="true" 
							 size="15" 
							 value="#{personaFisicaMBean.properties.rfc}" 
							 valueChangeListener="#{personaFisicaMBean.onRfcValueChangeListener}" />

			</p:panelGrid>

			<p></p>

			<p:commandButton id="guardarCommandButton" 
							 value="#{msg['button.guardar']}" 
							 ajax="true" 
							 event="click" 
							 actionListener="#{personaFisicaMBean.insertItemListener}" 
							 oncomplete="PF('wCreateItemDialog').hide()" 
							 update="itemsDataTable messages">
			</p:commandButton>

			<p:commandButton id="cancelarCommandButton" 
							 value="#{msg['button.cancelar']}" 
							 onclick="PF('wCreateItemDialog').hide()" 
							 type="button">
			</p:commandButton>

		</p:dialog>

		<p:confirmDialog id="eliminarConfirmDialog" 
						 closable="true" 
						 closeOnEscape="true" 
						 header="#{msg['header.eliminar.registro']}" 
						 widgetVar="wEliminarConfirmDialog" 
						 message="Â¿Desea eliminar los registros seleccionados?" 
						 severity="alert">

			<p:commandButton id="eliminarCommandButton" 
							 value="#{msg['button.si']}">
							 
				<p:ajax event="click" 
						listener="#{personaFisicaMBean.deleteItemsListener}" 
						oncomplete="PF('wEliminarConfirmDialog').hide()" 
						update="itemsDataTable messages" />
					
			</p:commandButton>

			<p:commandButton value="#{msg['button.no']}" 
							 onclick="PF('wEliminarConfirmDialog').hide();" 
							 type="button" />

		</p:confirmDialog>

	</h:form>

</h:body>

</html>