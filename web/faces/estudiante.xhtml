<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
	  xmlns:h="http://xmlns.jcp.org/jsf/html" 
	  xmlns:f="http://xmlns.jcp.org/jsf/core" 
	  xmlns:p="http://primefaces.org/ui" 
	  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	  xmlns:mysat="http://java.sun.com/jsf/composite/components">

<ui:composition template="templates/default-template.xhtml">
	
	<ui:define name="header">
		  <ui:include src="templates/header.xhtml" />
	</ui:define>
	
	<ui:define name="leftnav">
		  <ui:include src="templates/leftnav.xhtml" />
	</ui:define>

    <ui:define name="content">	

		<h:form id="frmMySat">
		
			<p></p>
	
			<p:messages id="messages" 
						showSummary="true" 
						showDetail="false" />
			
			<p></p>
			
			<p:dataTable id="itemsDataTable" 
						 value="#{estudianteMBean.results.resultsList}" 
						 var="est" 
						 rowExpandMode="single" 
						 rowKey="#{est.id}" 
						 selection="#{estudianteMBean.selectedItems}" 
						 editable="true">
						 
				<p:ajax event="rowEdit"
						listener="#{estudianteMBean.updateItemListener}"
						update="frmMySat:messages" />
	
				<p:ajax event="rowEditCancel"
						listener="#{estudianteMBean.rowCancelListener}" />
						
				<p:ajax event="rowSelect"
						listener="#{estudianteMBean.rowSelectListener}" />
		
					<f:facet name="header">
					
						<h4>
							<h:outputText value="#{bundle['title.estudiante']}" />
						</h4>
						
						<p:commandButton id="crearButton"  
										 type="button" 
										 onclick="PF('wCreateItemDialog').show();" 
										 value="#{bundle['button.crear']}" />
				
						<p:commandButton id="eliminarButton" 
										 type="button" 
										 widgetVar="wEliminarButton"
										 onclick="PF('wEliminarConfirmDialog').show();" 
										 value="#{bundle['button.eliminar']}" />
		
					</f:facet>
		
					<p:column selectionMode="multiple" 
							  width="40" />
			
						<p:column headerText="#{bundle['column.nombre']}" 
								  sortBy="#{est.persona.nombre}" 
								  filterBy="#{est.persona.nombre}" 
								  filterMatchMode="contains">
			
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{est.persona.nombre}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText id="editNombreInpTxt" 
												 value="#{est.persona.nombre}" 
												 label="#{bundle['label.nombre']}" 
										 		 required="true" 
										 		 size="30">
										<f:validateLength for="editNombreInpTxt"
														  minimum="3"
														  maximum="30" />
										<f:validator for="editNombreInpTxt" 
											 		 validatorId="nombreApellidoValidator" />
									</p:inputText>
								</f:facet>
							</p:cellEditor>
			
						</p:column>
			
						<p:column headerText="#{bundle['column.apellido']}" 
								  sortBy="#{est.persona.apellido}" 
								  filterBy="#{est.persona.apellido}" 
								  filterMatchMode="contains">
			
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{est.persona.apellido}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText id="editApellidoInpTxt"
												 value="#{est.persona.apellido}" 
												 label="#{bundle['label.apellido']}" 
										 		 required="true" 
										 		 size="30">
										<f:validateLength for="editApellidoInpTxt"
														  minimum="3"
														  maximum="30" />
										<f:validator for="editApellidoInpTxt" 
											 		 validatorId="nombreApellidoValidator" />
									</p:inputText>
								</f:facet>
							</p:cellEditor>
			
						</p:column>
			
						<p:column headerText="#{bundle['column.curp']}" 
								  sortBy="#{est.curp}" 
								  filterBy="#{est.curp}" 
								  filterMatchMode="contains">
			
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{est.curp}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText id="editCurpInpTxt" 
												 value="#{est.curp}" 
												 label="#{bundle['label.curp']}" 
										 		 required="true" 
										 		 size="20" 
										 		 style="text-transform: uppercase"
										 		 converter="uppercaseConverter">
										<f:validateLength for="editCurpInpTxt"
														  minimum="18"
														  maximum="18" />
										<f:validator for="editCurpInpTxt" 
											 		 validatorId="curpValidator" />
									</p:inputText>
								</f:facet>
							</p:cellEditor>
			
						</p:column>
						
						<p:column width="55">
				
							<p:rowEditor editTitle="#{bundle['button.editar']}" 
										 saveTitle="#{bundle['button.guardar']}" 
										 cancelTitle="#{bundle['button.cancelar']}" />
			
						</p:column>
						
						<p:column width="55">
						
							<p:commandButton id="viewItemCmdBtn" 
											 icon="fa fa-fw fa-search" 
											 type="button" 
											 title="#{bundle['button.ver']}">
											 
								<p:ajax event="click" 
										listener="#{estudianteMBean.viewItemListener(est)}"
										oncomplete="PF('wViewItemDlg').show()" 
										update=":frmMySat:viewItemDlg:viewItemOutPnl" />
								
							</p:commandButton>
			
						</p:column>
			
						<f:facet name="footer">
						
							<h:outputText value="Total de registros [#{fn:length(estudianteMBean.results.resultsList)}]" />
					
						</f:facet>
					
			</p:dataTable>
			
			<mysat:viewDialog id="viewItemDlg">
					  
				<p:panelGrid id="viewItemPnlGrd"
							 columns="3"
							 layout="grid"
							 style="margin: 30px">
							 
					<h:outputText value="#{bundle['label.nombre']}" />
					
					<h:outputText value="#{bundle['label.apellido']}" />
					
					<h:outputText value="#{bundle['label.curp']}" />
					
					<h:outputText value="#{estudianteMBean.selected.persona.nombre}" />
					
					<h:outputText value="#{estudianteMBean.selected.persona.apellido}" />
					
					<h:outputText value="#{estudianteMBean.selected.curp}" />
				
				</p:panelGrid>
				
				<p:dataTable id="viewItemDatTbl" 
							 value="#{estudianteMBean.selected.personaFisicas}" 
							 var="pf" 
							 rowKey="#{pf.id}" 
							 style="margin: 30px">
							 
					<f:facet name="header">
						
						<h4>
							<h:outputText value="#{bundle['title.persona.fisica']}" />
						</h4>
						
					</f:facet>

					<p:column headerText="#{bundle['column.nombre']}"
							  sortBy="#{pf.persona.nombre}">

						<h:outputText value="#{pf.persona.nombre}" />

					</p:column>

					<p:column headerText="#{bundle['column.apellido']}"
							  sortBy="#{pf.persona.apellido}">

						<h:outputText value="#{pf.persona.apellido}" />

					</p:column>

					<p:column  headerText="#{bundle['column.rfc']}"
							  sortBy="#{pf.rfc}">

						<h:outputText value="#{pf.rfc}" />

					</p:column>

				</p:dataTable>
				
			</mysat:viewDialog>
			
			<mysat:insertDialog id="createItemDialog" 
								ajaxActionListener="#{estudianteMBean.insertItemListener}">
								
				<p:outputLabel for="nombreInputText" 
							   value="#{bundle['label.nombre']}" />

				<p:inputText id="nombreInputText" 
							 label="#{bundle['label.nombre']}" 
							 required="true" 
							 size="30" 
							 value="#{estudianteMBean.properties.persona.nombre}">
					<f:validateLength for="nombreInputText"
									  minimum="3"
									  maximum="30" />
					<f:validator for="nombreInputText" 
								 validatorId="nombreApellidoValidator" />
				</p:inputText>

				<p:outputLabel for="apellidoInputText"
							   value="#{bundle['label.apellido']}" />

				<p:inputText id="apellidoInputText" 
							 label="#{bundle['label.apellido']}" 
							 required="true" 
							 size="30" 
							 value="#{estudianteMBean.properties.persona.apellido}">
					<f:validateLength for="apellidoInputText"
									  minimum="3"
									  maximum="30" />
					<f:validator for="apellidoInputText" 
								 validatorId="nombreApellidoValidator" />
				</p:inputText>

				<p:outputLabel for="curpInputText"
							   value="#{bundle['label.curp']}" />

				<p:inputText id="curpInputText" 
							 label="#{bundle['label.curp']}" 
							 required="true" 
							 size="20" 
							 value="#{estudianteMBean.properties.curp}"
							 style="text-transform: uppercase"
							 converter="uppercaseConverter">
					<f:validateLength for="curpInputText"
									  minimum="18"
									  maximum="18" />
					<f:validator for="curpInputText" 
								 validatorId="curpValidator" />
				</p:inputText>
								
								
			</mysat:insertDialog>
			
			<mysat:deleteConfirmDialog id="eliminarConfirmDialog" 
									   ajaxEventListener="#{estudianteMBean.deleteItemsListener}" />
	
		</h:form>
	
	</ui:define>
	
	<ui:define name="footer">
		  <ui:include src="templates/footer.xhtml" />
	</ui:define>

</ui:composition>

</html>